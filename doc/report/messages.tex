\section{Messages}
\subsection{\texttt{SECURE MESSAGE}}
Carries an encrypted message.
\begin{figure}[h]
	\centering
	\begin{bytefield}[bitwidth=1.1em]{32}
		\bitheader{0-31} \\
		\bitbox{2}{\texttt{len}} 
		& \bitbox{1}{\texttt{0}} 
		& \bitbox{29}{\texttt{ciphertext}} \\
		& \bitbox{32}{\texttt{...}} \\
		& \bitbox{32}{\texttt{ciphertext}} \\
		\begin{rightwordgroup}{TAG - 16 bytes}
			\bitbox{32}{\texttt{tag}} \\
			\bitbox{32}{\texttt{...}} \\
			\bitbox{32}{\texttt{tag}}
		\end{rightwordgroup} \\
	\end{bytefield}
\end{figure}
\begin{itemize}
	\item len: length of the message
	\item 0: type of the message (SECURE\_MESSAGE)
	\item ciphertext: encrypted message
	\item tag: aes\_gcm verification tag
\end{itemize}

\subsection{\texttt{CLIENT HELLO}}
Sent by a client when a new connection has to be started.
\begin{figure}[h]
	\centering
	\begin{bytefield}[bitwidth=1.1em]{32}
		\bitheader{0-31} \\
		\bitbox{2}{\texttt{len}} 
		& \bitbox{1}{\texttt{1}} \\
		& \bitbox{32}{\texttt{nonce}} \\
		& \bitbox{16}{\texttt{client id}}
		& \bitbox{16}{\texttt{server id}} \\
		& \bitbox{32}{\texttt{eph key}} \\
		& \bitbox{32}{\texttt{...}}\\
		& \bitbox{32}{\texttt{eph key}}
	\end{bytefield}
\end{figure}

\begin{itemize}
	\item len: length of the message
	\item 1: type of the message (CLIENT\_HELLO)
	\item nonce: random integer generated by the client
	\item client id: identifier of the client
	\item server id: identifier of the server
	\item eph key: DH ephemeral key of the client
\end{itemize}

\subsection{\texttt{SERVER HELLO}}
Server reply to the previous message.
\begin{figure}[h]
	\centering
	\begin{bytefield}[bitwidth=1.1em]{32}
		\bitheader{0-31} \\
		\bitbox{2}{\texttt{len}} 
		& \bitbox{1}{\texttt{2}} \\
		& \bitbox{32}{\texttt{nonce}} \\
		& \bitbox{16}{\texttt{server id}}
		& \bitbox{16}{\texttt{client id}} \\
		\begin{rightwordgroup}{DS}
			\bitbox{32}{\texttt{digital signature}} \\
			\bitbox{32}{...} \\
			\bitbox{32}{\texttt{digital signature}}
		\end{rightwordgroup} \\
	\end{bytefield}
\end{figure}

\begin{itemize}
	\item len: length of the message
	\item 2: type of the message (SERVER\_HELLO)
	\item nonce: random integer generated by the server
	\item server id: identifier of the server
	\item client id: identifier of the client
	\item digital signature: digital signature of the server
\end{itemize}

\subsection{\texttt{CLIENT VERIFY}}
Client sends its digital signature.
\begin{figure}[h]
	\centering
	\begin{bytefield}[bitwidth=1.1em]{32}
		\bitheader{0-31} \\
		\bitbox{2}{\texttt{len}} 
		& \bitbox{1}{\texttt{3}} \\
		\begin{rightwordgroup}{DS}
			\bitbox{32}{\texttt{digital signature}} \\
			\bitbox{32}{...} \\
			\bitbox{32}{\texttt{digital signature}}
		\end{rightwordgroup} \\
	\end{bytefield}
\end{figure}

\begin{itemize}
	\item len: length of the message
	\item 3: type of the message (CLIENT\_VERIFY)
	\item digital signature: digital signature of the client
\end{itemize}

\subsection{\texttt{START GAME PEER}}
Message sent when an user wants to start a game with another peer.
\begin{figure}[h]
	\centering
	\begin{bytefield}[bitwidth=1.1em]{16}
		\bitheader{0-2} \\
		\bitbox{2}{\texttt{len}} 
		& \bitbox{1}{\texttt{4}}
	\end{bytefield}
\end{figure}

\begin{itemize}
	\item len: length of the message
	\item 4: type of the message (START\_GAME\_PEER)
\end{itemize}

\subsection{\texttt{MOVE}}
Message containing the next move of the user
\begin{figure}[!htbp]
	\centering
	\begin{bytefield}[bitwidth=1.1em]{16}
		\bitheader{0-3} \\
		\bitbox{2}{\texttt{len}} 
		& \bitbox{1}{\texttt{5}}
		& \bitbox{1}{\texttt{c}}
	\end{bytefield}
\end{figure}

\begin{itemize}
	\item len: length of the message
	\item 4: type of the message (MOVE)
	\item c: chosen column where to insert the token
\end{itemize}


\subsection{\texttt{REGISTER}}
Registers user to the server.
\begin{figure}[h]
	\centering
	\begin{bytefield}[bitwidth=1.1em]{16}
		\bitheader{0-18} \\
		\bitbox{2}{\texttt{len}} 
		& \bitbox{1}{\texttt{6}} 
		& \bitbox{16}{\texttt{username}}
	\end{bytefield}
\end{figure}

\begin{itemize}
	\item len: length of the message
	\item 6: type of the message (REGISTER)
	\item username: chosen username, min 3 max 16 char.
\end{itemize}

\subsection{\texttt{CHALLENGE}}
Sends a challenge to a user.
\begin{figure}[h]
	\centering
	\begin{bytefield}[bitwidth=1.1em]{16}
		\bitheader{0-18} \\
		\bitbox{2}{\texttt{len}} 
		& \bitbox{1}{\texttt{7}} 
		& \bitbox{16}{\texttt{username}}
	\end{bytefield}
\end{figure}

\begin{itemize}
	\item len: length of the message
	\item 7: type of the message (CHALLENGE)
	\item username: adversary to challenge.
\end{itemize}

\subsection{\texttt{GAME END}}
Signals end of the match.
\begin{figure}[!htbp]
	\centering
	\begin{bytefield}[bitwidth=1.1em]{16}
		\bitheader{0-2} \\
		\bitbox{2}{\texttt{len}} 
		& \bitbox{1}{\texttt{8}} 
	\end{bytefield}
\end{figure}

\begin{itemize}
	\item len: length of the message
	\item 8: type of the message (GAME\_END)
\end{itemize}

\subsection{\texttt{USERS LIST}}
Transports the list of all the active users.
\begin{figure}[!htbp]
	\centering
	\begin{bytefield}[bitwidth=1.1em]{32}
		\bitheader{0-31} \\
		\bitbox{2}{\texttt{len}} 
		& \bitbox{1}{\texttt{9}}
		& \bitbox{29}{\texttt{usernames list}} \\
		& \bitbox{32}{\texttt{...}} \\
		& \bitbox{32}{\texttt{usernames list}} \\ 
	\end{bytefield}
\end{figure}

\begin{itemize}
	\item len: length of the message
	\item 9: type of the message (USERS\_LIST)
\end{itemize}

\subsection{\texttt{USERS LIST REQUEST}}
Requests the list of all the active users
\begin{figure}[!h]
	\centering
	\begin{bytefield}[bitwidth=1.1em]{32}
		\bitheader{0-31} \\
		\bitbox{2}{\texttt{len}} 
		& \bitbox{1}{\texttt{10}} \\
		& \bitbox{32}{\texttt{offset}} \\
	\end{bytefield}
\end{figure}

\begin{itemize}
	\item len: length of the message
	\item 10: type of the message (USERS\_LIST)
	\item offset: offset for the list of users we want to receive (where to start from)
\end{itemize}

\subsection{\texttt{CHALLENGE FORWARD}}
Message forwarded from the server to the peer to signal an incoming challenge.
\begin{figure}[!h]
	\centering
	\begin{bytefield}[bitwidth=1.1em]{32}
		\bitheader{0-18} \\
		\bitbox{2}{\texttt{len}} 
		& \bitbox{1}{\texttt{11}}
		& \bitbox{16}{\texttt{username}} \\
	\end{bytefield}
\end{figure}

\begin{itemize}
	\item len: length of the message
	\item 11: type of the message (CHALLENGE\_FORWARD)
	\item username: username of the challenger
\end{itemize}

\subsection{\texttt{CHALLENGE RESPONSE}}
Message carrying the response to a challenge.
\begin{figure}[!h]
	\centering
	\begin{bytefield}[bitwidth=1.1em]{32}
		\bitheader{0-26} \\
		\bitbox{2}{\texttt{len}} 
		& \bitbox{1}{\texttt{12}}
		& \bitbox{8}{\texttt{response}}
		& \bitbox{16}{\texttt{listen port}}
	\end{bytefield}
\end{figure}

\begin{itemize}
	\item len: length of the message
	\item 12: type of the message (CHALLENGE\_RESPONSE)
	\item response: response accepted or refused
	\item listen port: if accepted, the port on which the user is listening
	\item username: username of the challenger
\end{itemize}

